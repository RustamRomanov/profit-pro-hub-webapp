document.addEventListener('DOMContentLoaded', () => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ Mini App –∑–∞–ø—É—â–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
    if (window.Telegram.WebApp) {
        const tg = window.Telegram.WebApp;
        tg.ready();
        
        const userId = tg.initDataUnsafe.user.id;
        
        // --- –ò–º–∏—Ç–∞—Ü–∏—è –†–æ–ª–∏ ---
        // –î–ª—è MVP: –µ—Å–ª–∏ user_id —á–µ—Ç–Ω—ã–π - –†–∞–±–æ—Ç–Ω–∏–∫, –Ω–µ—á–µ—Ç–Ω—ã–π - –ó–∞–∫–∞–∑—á–∏–∫
        // –í–ê–ñ–ù–û: –í —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç AJAX-–∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É Python-–±—ç–∫–µ–Ω–¥—É!
        // –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ë–î, –º—ã –∏–º–∏—Ç–∏—Ä—É–µ–º —Ä–æ–ª—å, 
        // –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        const isCustomerMode = userId % 2 !== 0; 
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –∫–Ω–æ–ø–∫–∏ Telegram –≤ Mini App
        tg.MainButton.setText("–ó–∞–∫—Ä—ã—Ç—å –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ");
        tg.MainButton.onClick(() => tg.close());
        tg.MainButton.show();
        
        renderInterface(isCustomerMode, userId);

    } else {
        document.getElementById('app-container').innerHTML = 
            "<h2>–û—à–∏–±–∫–∞</h2><p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ Telegram-–±–æ—Ç–∞.</p>";
    }
});

function renderInterface(isCustomer, userId) {
    const container = document.getElementById('app-container');
    
    if (isCustomer) {
        // --- –ò–ù–¢–ï–†–§–ï–ô–° –ó–ê–ö–ê–ó–ß–ò–ö–ê (–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ) ---
        container.innerHTML = `
            <h2>üí∞ –†–µ–∂–∏–º –ó–∞–∫–∞–∑—á–∏–∫–∞ (–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ)</h2>
            <p>–í–∞—à ID: <b>${userId}</b></p>
            <hr>
            <h3>üìä –¢–µ–∫—É—â–∏–µ –ö–∞–º–ø–∞–Ω–∏–∏ (–ò–º–∏—Ç–∞—Ü–∏—è)</h3>
            <p>–ë–∞–ª–∞–Ω—Å: 0.00 TON | –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π: 1</p>
            
            <div class="task-card">
                <h4>‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª X</h4>
                <p>–ë—é–¥–∂–µ—Ç: 45.2 TON | –í—ã–ø–æ–ª–Ω–µ–Ω–æ: 152/500</p>
                <button class="btn-primary" onclick="alert('–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –∑–∞–¥–∞–Ω–∏—è (–∑–∞–≥–ª—É—à–∫–∞)')">
                    –£–ü–†–ê–í–õ–Ø–¢–¨
                </button>
            </div>
            
            <button class="btn-primary" style="width: 100%; margin-top: 20px;" onclick="alert('–ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é —Å—á–µ—Ç–∞ (–∑–∞–≥–ª—É—à–∫–∞)')">
                –ü–û–ü–û–õ–ù–ò–¢–¨ –°–ß–Å–¢ (TON)
            </button>
            <button style="width: 100%; margin-top: 10px; background-color: #3f51b5; color: white;" onclick="alert('–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è (–∑–∞–≥–ª—É—à–∫–∞)')">
                –°–û–ó–î–ê–¢–¨ –ù–û–í–û–ï –ó–ê–î–ê–ù–ò–ï
            </button>
        `;
    } else {
        // --- –ò–ù–¢–ï–†–§–ï–ô–° –†–ê–ë–û–¢–ù–ò–ö–ê (–ó–∞—Ä–∞–±–æ—Ç–æ–∫) ---
        container.innerHTML = `
            <h2>üí∏ –†–µ–∂–∏–º –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–ó–∞—Ä–∞–±–æ—Ç–æ–∫)</h2>
            <p>–í–∞—à ID: <b>${userId}</b></p>
            <hr>
            <h3>üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –ó–∞–¥–∞–Ω–∏—è</h3>
            <p>–í–∞—à –ê–∫—Ç–∏–≤–Ω—ã–π –±–∞–ª–∞–Ω—Å: 0.00 TON | –í –≠—Å–∫—Ä–æ—É: 0.00 TON (–∏–º–∏—Ç–∞—Ü–∏—è)</p>

            <div class="task-card">
                <h4>–ü–æ–¥–ø–∏—Å–∫–∞: –ö–∞–Ω–∞–ª Profit Pro</h4>
                <p>üí∞ –¶–µ–Ω–∞: <b>0.15 TON</b> | –°—Ä–æ–∫ –≠—Å–∫—Ä–æ—É: 7 –¥–Ω–µ–π</p>
                <button class="btn-primary" onclick="alert('–í—ã–ø–æ–ª–Ω–µ–Ω–æ! –î–µ–Ω—å–≥–∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω—ã –≤ –≠—Å–∫—Ä–æ—É.')">
                    –í–´–ü–û–õ–ù–ò–¢–¨ –ó–ê–î–ê–ù–ò–ï
                </button>
            </div>
            
            <div class="task-card">
                <h4>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h4>
                <p>üí∞ –¶–µ–Ω–∞: <b>0.10 TON</b> | –ü—Ä–æ–≤–µ—Ä–∫–∞: 24 —á–∞—Å–∞</p>
                <button class="btn-primary" onclick="alert('–í—ã–ø–æ–ª–Ω–µ–Ω–æ! –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ.')">
                    –í–´–ü–û–õ–ù–ò–¢–¨ –ó–ê–î–ê–ù–ò–ï
                </button>
            </div>
            
            <button style="width: 100%; margin-top: 20px; background-color: #4CAF50; color: white;" onclick="alert('–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ (–∑–∞–≥–ª—É—à–∫–∞)')">
                –í–´–í–ï–°–¢–ò –°–†–ï–î–°–¢–í–ê
            </button>
        `;
    }
}